#!/bin/bash

set -e

WORKDIR="/root/RedTeamToolkit/exploitation"
GITHUB="https://github.com"

# Create working directory if it doesn't exist
mkdir -p "$WORKDIR"

echo "Installing exploitation tools"

# Update and install necessary packages
apt update && apt install -y john ruby2.7 sudo golang-go libusb-1.0-0

# Function to clone a repository if it doesn't exist
clone_repo() {
    local repo_url=$1
    local target_dir=$2
    if [ ! -d "$target_dir" ]; then
        git clone "$repo_url" "$target_dir"
    else
        echo "Repository $repo_url already cloned in $target_dir"
    fi
}

# Change to working directory
cd "$WORKDIR"

# Clone repositories
clone_repo "$GITHUB/cbk914/PayloadsAllTheThings.git" "$WORKDIR/PayloadsAllTheThings"
clone_repo "$GITHUB/SecureAuthCorp/impacket.git" "$WORKDIR/impacket"
if [ -d "$WORKDIR/impacket" ]; then
    cd "$WORKDIR/impacket"
    pip3 install tox
fi

clone_repo "$GITHUB/beefproject/beef.git" "$WORKDIR/beef"
if [ -d "$WORKDIR/beef" ]; then
    cd "$WORKDIR/beef"
    ./install
fi

clone_repo "$GITHUB/bettercap/bettercap.git" "$WORKDIR/bettercap"
clone_repo "$GITHUB/Puliczek/CVE-2021-44228-PoC-log4j-bypass-words.git" "$WORKDIR/CVE-2021-44228-PoC-log4j-bypass-words"
clone_repo "$GITHUB/cyberstruggle/L4sh.git" "$WORKDIR/L4sh"
if [ -d "$WORKDIR/L4sh" ]; then
    cd "$WORKDIR/L4sh"
    pip3 install -r requirements.txt
fi

clone_repo "$GITHUB/SecuProject/ADenum.git" "$WORKDIR/ADenum"
if [ -d "$WORKDIR/ADenum" ]; then
    cd "$WORKDIR/ADenum"
    pip3 install -r requirements.txt
fi

# Install Metasploit
cd "$WORKDIR"
curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall
chmod +x msfinstall
./msfinstall
msfdb init

# Uncomment to clone and install Sn1per
clone_repo "$GITHUB/1N3/Sn1per.git" "$WORKDIR/Sn1per"
if [ -d "$WORKDIR/Sn1per" ]; then
    cd "$WORKDIR/Sn1per"
    bash install.sh
fi

echo "Done"
