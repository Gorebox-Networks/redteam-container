#!/bin/bash

set -e

WORKDIR="/root/RedTeamToolkit/postexploitation"
GITHUB="https://github.com"

# Create working directory if it doesn't exist
mkdir -p "$WORKDIR"

echo "Installing postexploitation tools"

# Update and install necessary packages
apt update && apt install -y python3-poetry-core powersploit starkiller libssl1.0-dev libffi-dev swig

# Function to clone a repository if it doesn't exist
clone_repo() {
    local repo_url=$1
    local target_dir=$2
    if [ ! -d "$target_dir" ]; then
        git clone "$repo_url" "$target_dir"
    else
        echo "Repository $repo_url already cloned in $target_dir"
    fi
}

# Change to working directory
cd "$WORKDIR"

# Clone and setup repositories
clone_repo "$GITHUB/BC-SECURITY/Empire.git" "$WORKDIR/Empire"
clone_repo "$GITHUB/Cn33liz/StarFighters.git" "$WORKDIR/StarFighters"
clone_repo "$GITHUB/n1nj4sec/pupy.git" "$WORKDIR/pupy"
clone_repo "$GITHUB/byt3bl33d3r/gcat.git" "$WORKDIR/gcat"
clone_repo "$GITHUB/Ne0nd0g/merlin.git" "$WORKDIR/merlin"

clone_repo "$GITHUB/epinna/weevely3.git" "$WORKDIR/weevely3"
if [ -d "$WORKDIR/weevely3" ]; then
    cd "$WORKDIR/weevely3"
    pip3 install -r requirements.txt
fi

echo "Done"
